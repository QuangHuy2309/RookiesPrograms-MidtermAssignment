-- public.categories definition

-- Drop table

-- DROP TABLE public.categories;

CREATE TABLE public.categories (
	id serial NOT NULL,
	"name" text NOT NULL,
	description text NULL,
	CONSTRAINT categories_pkey PRIMARY KEY (id)
);


-- public.persons definition

-- Drop table

-- DROP TABLE public.persons;

CREATE TABLE public.persons (
	id serial not null,
	email text NOT NULL,
	"password" text NOT NULL,
	fullname text NOT NULL,
	dob date NULL,
	gender bool NULL,
	address text NULL,
	phonenumber varchar(12) NULL,
	"role" text NOT NULL,
	CONSTRAINT persons_pkey PRIMARY KEY (id)
);


-- public.orderbill definition

-- Drop table

-- DROP TABLE public.orderbill;

CREATE TABLE public.orderbill (
	id int4 NOT NULL GENERATED ALWAYS AS IDENTITY,
	customerid int NOT NULL,
	timebought timestamp NOT NULL,
	totalcost numeric NOT NULL,
	address text NOT NULL,
	status bool NOT NULL,
	CONSTRAINT orderbill_pk PRIMARY KEY (id),
	CONSTRAINT fk_persons FOREIGN KEY (customerid) REFERENCES public.persons(id)
);


-- public.products definition

-- Drop table

-- DROP TABLE public.products;

CREATE TABLE public.products (
	id text NOT NULL,
	"name" text NOT NULL,
	price numeric NOT NULL,
	quantity int4 NOT NULL,
	producttype int4 NOT NULL,
	description text NULL,
	brand text NULL,
	photo text NULL,
	createdate timestamp NOT NULL,
	updatedate timestamp NOT NULL,
	CONSTRAINT products_pkey PRIMARY KEY (id),
	CONSTRAINT fk_products_categories FOREIGN KEY (producttype) REFERENCES public.categories(id) ON UPDATE CASCADE
);
======================================= CREATE DATABASE =========================================

-- public.review definition

-- Drop table

-- DROP TABLE public.review;

CREATE TABLE public.review (
	productid text NOT NULL,
	customerid int NOT NULL,
	rate_num int4 NULL DEFAULT 0,
	rate_text text NULL,
	datereview date NULL,
	CONSTRAINT email_product_pkey PRIMARY KEY (customerid, productid),
	CONSTRAINT review_customeremail_fkey FOREIGN KEY (customerid) REFERENCES public.persons(id) ON UPDATE CASCADE,
	CONSTRAINT review_productid_fkey FOREIGN KEY (productid) REFERENCES public.products(id) ON DELETE CASCADE ON UPDATE CASCADE
);


-- public.orderdetails definition

-- Drop table

-- DROP TABLE public.orderdetails;

CREATE TABLE public.orderdetails (
	orderid int4 NOT NULL,
	productid text NOT NULL,
	amount int4 NOT NULL DEFAULT 1,
	CONSTRAINT bill_product_pkey PRIMARY KEY (orderid, productid),
	CONSTRAINT orderdetails_orderid_fkey FOREIGN KEY (orderid) REFERENCES public.orderbill(id) ON DELETE CASCADE ON UPDATE CASCADE,
	CONSTRAINT orderdetails_productid_fkey FOREIGN KEY (productid) REFERENCES public.products(id) ON UPDATE CASCADE
);
================================ +++++++++++++++++++++++++++++++++ ==================================
insert into persons 
values ('shynhyn319@gmail.com','123','Lê Hoàng Nhât Lâm','1999-02-03',B'0','TP HCM','0967123456','admin'),
		('lqhuy2309@gmail.com','123','Luơng Quang Huy','1999-09-23',B'0','Long An','0967123456','user'),
		('nguyenvana@gmail.com','123','Nguyên Văn A','1999-01-01',B'0','Bến Tre','0967123456','user')
alter table orderbill 
add column status boolean not null,
add column rate_num int null, 
add column rate_text text null;
insert into products 
values ('A','b',1000,23,'mountain','abc','giant')


ALTER TABLE products 
ADD CONSTRAINT fk_products_categories 
FOREIGN KEY (producttype) 
REFERENCES categories (id);


insert into categories (categoriesname ,description ) 
values ('Mountain','Bike for Mountaing'), ('Road','Bike for long road'), ('Race','Bike for Racing')


insert into orderbill (productid , customeremail , quantity, timebought, totalcost, address,status) 
values ('A','lqhuy2309@gmail.com',3,'2021-01-02',3000,'Bike for Racing',true)

alter table products 
add column createdate timestamp,
add column updatedate timestamp

TRUNCATE TABLE orderbill RESTART IDENTITY; // reset auto increase

